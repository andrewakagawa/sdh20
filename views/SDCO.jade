extends layout

block content
  script(src='http://d3js.org/d3.v3.min.js')
  script(src='http://code.jquery.com/jquery.js')
  script(src='/lib/bootstrap/bootstrap.min.js')
  include includes/mainmenu.jade


  .container
    .row-fluid
        h1 San Diego County Health Data (from 2011)
        ul.nav.nav-tabs.data-tabs-main
          li
            a(href='#item1', data-toggle='tab') Deaths
          li
            a(href='#item2', data-toggle='tab') Hospitalizations
          li
            a(href='#item3', data-toggle='tab') Emergency
        .tab-content
          #item1.tab-pane.active
            .main-pareto
              //
                Div that will hold the chart
              #chart_div

                script.
                  var margin = {top: 80, right: 20, bottom: 30, left: 50},
                  width = 1000 - margin.left - margin.right;
                  height = 3500 - margin.top - margin.bottom;
                  var y = d3.scale.ordinal()
                  .rangeRoundBands([0, height], .1, 1);
                  var x = d3.scale.linear()
                  .range([0, width]);
                  var yAxis = d3.svg.axis()
                  .scale(y)
                  .orient("right");
                  var xAxis = d3.svg.axis()
                 .scale(x)
                  .orient("bottom")
                  var svg = d3.select("#chart_div").append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                  d3.csv("data.csv", function(error, data) {
                  data.forEach(function(d) {
                  d.deathrate = +d.deathrate;
                  });
                  y.domain(data.map(function(d) { return d.SRA; }));
                  x.domain([0, d3.max(data, function(d) { return d.deathrate; })]);
                  svg.selectAll(".bar")
                  .data(data)
                  .enter().append("rect")
                  .attr("class", "bar")
                  .attr("y", function(d) { return y(d.SRA); })
                  .attr("height", y.rangeBand())
                  .attr("width", function(d) { return x(d.deathrate); });
                  svg.append("g")
                  .attr("class", "y axis")
                  .call(yAxis)
                  .selectAll("text")
                  .style("text-anchor", "start")
                  .style("font", "24px")
                  .attr("dy", "5px");
                  svg.append("g")
                  .attr("class", "x axis")
                  .call(xAxis)
                  .append("text")
                  .style("text-anchor", "end")
                  .attr("x", width)
                  .attr("dy", -50)
                  .text("Rate /1000");
                  d3.select("input").on("change", change);
                  var sortTimeout = setTimeout(function() {
                  d3.select("input").property("checked", true).each(change);
                  }, 2000);
                  function change() {
                  clearTimeout(sortTimeout);
                  // Copy-on-write since tweens are evaluated after a delay.
                  var y0 = y.domain(data.sort(this.checked
                  ? function(a, b) { return b.deathrate - a.deathrate; }
                  : function(a, b) { return d3.ascending(a.SRA, b.SRA); })
                  .map(function(d) { return d.SRA; }))
                  .copy();
                  var transition = svg.transition().duration(750),
                  delay = function(d, i) { return i * 50; };
                  transition.selectAll(".bar")
                  .delay(delay)
                  .attr("y", function(d) { return y0(d.SRA); });
                  transition.select(".y.axis")
                  .call(yAxis)
                  .selectAll("text")
                  .style("text-anchor", "start")
                  .selectAll("g")
                  .delay(delay);
                  }
                  });
                label
                  input(type='checkbox')
                  | Sort values


          #item2.tab-pane
            .main-pareto
              //
                Div that will hold the chart
              #chart_div2
          #item3.tab-pane
            .main-pareto
              //
                Div that will hold the chart
              #chart_div3

